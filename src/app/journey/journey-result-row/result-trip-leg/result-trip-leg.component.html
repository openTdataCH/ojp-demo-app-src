<!-- <div class="border p-2 mb-2">
  <div class="mb-2 d-flex flex-row"> -->

<div>
  <div class="mb-2 d-flex flex-row">
    <button 
      type="button" 
      class="btn btn-primary btn-sm font-weight-bold" 
      [ngStyle]="{'background-color': this.legInfoDataModel.legColor, 'border-color': this.legInfoDataModel.legColor}"
      (click)="handleTapOnLegHeading()">{{ this.legInfoDataModel.leadingText }}</button>
  
    <div class="ms-auto" *ngIf="this.isEmbed === false">
      <div
        class="badge leg-pill pill-hover bg-primary"
        (click)="handleTapOnLegHeading()"
      >MAP</div>
    </div>
  </div>
  
  <div class="mb-2 d-flex flex-row align-items-center">
    <div class="flex-grow-0 leg-left-side">
      <div class="d-flex flex-column leg-icon-wrapper">
        <div class="text-center">
          <img class="leg-icon" src="{{ this.legInfoDataModel.legIconPath }}" />
        </div>
        <div class="text-center">{{ this.legInfoDataModel.distanceText }}</div>
      </div>
    </div>
    
    <div class="flex-grow-1">
      <ng-container
        *ngIf="this.legInfoDataModel.legTemplate == 'walk' then walkingLegTemplate;">
      </ng-container>
      <ng-container
        *ngIf="this.legInfoDataModel.legTemplate == 'timed' then timedLegTemplate;">
      </ng-container>
      <ng-container
        *ngIf="this.legInfoDataModel.legTemplate == 'taxi' then taxiLegTemplate;">
      </ng-container>
    </div>
  </div>
  
  <div class="mb-2">
    <div class="border-bottom" style="height: 8px"></div>
  </div>
</div>

<ng-template #timedLegTemplate>
  <div class="d-flex flex-row align-items-center">
    <div 
      class="flex-grow-1 leg-location location-hover" 
      (click)="this.handleClickOnLocation('From')"
    >
      <div class="d-flex">
        <div>{{ this.legInfoDataModel.fromLocationData.locationText }}</div>
        <div *ngIf="this.legInfoDataModel.fromLocationData.platformText">
          <div *ngIf="!this.legInfoDataModel.fromLocationData.actualPlatformText">
            <div>, Pl. {{ this.legInfoDataModel.fromLocationData.platformText }}</div>  
          </div>
          <div *ngIf="this.legInfoDataModel.fromLocationData.actualPlatformText">
            <div>, Pl. <del> {{ this.legInfoDataModel.fromLocationData.platformText }}</del> <span class="time-delay"> {{ this.legInfoDataModel.fromLocationData.actualPlatformText }}</span></div>
          </div>
        </div>
      </div>
    </div>

    <div 
      class="flex-grow-0 leg-time leg-right-side">
      <img *ngIf="this.legInfoDataModel.fromLocationData.platformAssistanceIconPath !== null"
        class="leg-platform-assistance" 
        src="{{ this.legInfoDataModel.fromLocationData.platformAssistanceIconPath }}" 
        title="{{ this.legInfoDataModel.fromLocationData.platformAssistanceTooltip }}" />
      <span>{{ this.legInfoDataModel.fromLocationData.depText }}</span>
      <span class="time-delay">{{ this.legInfoDataModel.fromLocationData.depDelayText }}</span>
    </div>
  </div>

  <div class="px-2">
    <div class="d-flex flex-row align-items-center" style="height: 16px;">
      <div class="separator"></div>
    </div>

    <ng-container *ngTemplateOutlet="timedLegTemplateVariant2"></ng-container>

    <div class="d-flex flex-row align-items-center" style="height: 16px;">
      <div class="separator"></div>
    </div>
  </div>

  <div class="d-flex flex-row align-items-center">
    <div 
      class="flex-grow-1 leg-location location-hover"
      (click)="this.handleClickOnLocation('To')"
    >
      <div class="d-flex">
        <div>{{ this.legInfoDataModel.toLocationData.locationText }}</div>
        <div *ngIf="this.legInfoDataModel.toLocationData.platformText">
          <div *ngIf="!this.legInfoDataModel.toLocationData.actualPlatformText">
            <div>, Pl. {{ this.legInfoDataModel.toLocationData.platformText }}</div>  
          </div>
          <div *ngIf="this.legInfoDataModel.toLocationData.actualPlatformText">
            <div>, Pl. <del> {{ this.legInfoDataModel.toLocationData.platformText }}</del> <span class="time-delay"> {{ this.legInfoDataModel.toLocationData.actualPlatformText }}</span></div>
          </div>
        </div>
      </div>
    </div>
    
    <div 
      class="flex-grow-0 leg-time leg-right-side">
      <img *ngIf="this.legInfoDataModel.toLocationData.platformAssistanceIconPath !== null"
        class="leg-platform-assistance" 
        src="{{ this.legInfoDataModel.toLocationData.platformAssistanceIconPath }}" 
        title="{{ this.legInfoDataModel.toLocationData.platformAssistanceTooltip }}" />
      <span>{{ this.legInfoDataModel.toLocationData.arrText }}</span>
      <span class="time-delay">{{ this.legInfoDataModel.toLocationData.arrDelayText }}</span>
    </div>
  </div>
</ng-template>

<ng-template #walkingLegTemplate>
  <div class="d-flex flex-row align-items-center">
    <div class="flex-grow-1 leg-location">
      <div class="d-flex flex-column leg-location">
        <div 
          class="location-hover"
          (click)="this.handleClickOnLocation('From')"
        >{{ this.legInfoDataModel.fromLocationData.locationText }}</div>

        <sbb-tooltip svgIcon="kom:arrow-change-horizontal-medium" *ngIf="this.legInfoDataModel.hasGuidance">
          <ul class="tooltip-list">
            <li *ngFor="let guidanceText of this.legInfoDataModel.guidanceTextLines">
              {{ guidanceText }}
            </li>
          </ul>
        </sbb-tooltip>

        <div *ngIf="this.legInfoDataModel.hasGuidance == false">
          <div class="border-bottom" style="height: 8px; margin-left: 4px; margin-right: 8px;"></div>
        </div>
      
        <div 
          class="location-hover"
          (click)="this.handleClickOnLocation('To')"
        >{{ this.legInfoDataModel.toLocationData.locationText }}</div>
      </div>
    </div>
    
    <div class="flex-grow-0 leg-time leg-right-side">
      <div>{{ this.legInfoDataModel.durationText }}</div>
    </div>
  </div>
</ng-template>

<ng-template #taxiLegTemplate>
  <div class="d-flex flex-row align-items-center">
    <div class="flex-grow-1 leg-location">
      <div class="d-flex flex-column leg-location">
        <div 
          class="location-hover"
          (click)="this.handleClickOnLocation('From')"
        >{{ this.legInfoDataModel.fromLocationData.locationText }}</div>

        <ul class="booking-arrangement">
          <li *ngFor="let bookingArrangement of this.legInfoDataModel.bookingArrangements">
            Book on <a href="{{ bookingArrangement.infoURL }}" target="_blank">{{ bookingArrangement.agencyName }}</a>
          </li>
        </ul>

        <div 
          class="location-hover"
          (click)="this.handleClickOnLocation('To')"
        >{{ this.legInfoDataModel.toLocationData.locationText }}</div>
      </div>
    </div>
    <div class="flex-grow-0 leg-time leg-right-side">
      <div>{{ this.legInfoDataModel.durationText }}</div>
    </div>
  </div>
</ng-template>

<ng-template #timedLegTemplateVariant2>
  <!-- SERVICE + HEADING -->
  <div class="d-flex gap-1 align-items-center">
    <div>
       <button class="btn btn-primary btn-sm" (click)="loadTripInfoResultPopover(this.legInfoDataModel.serviceJourneyRef)">{{ this.legInfoDataModel.serviceInfo }}</button>
    </div>
    
    <div> to {{ this.legInfoDataModel.serviceDestinationText }}</div>
  </div>

  <!-- INTERMEDIARY_STOPS + ATTRIBUTES -->
  <div class="d-flex gap-2 align-items-center mt-2">
    <div *ngIf="this.legInfoDataModel.serviceIntermediaryStopsText !== null">
      <button type="button" class="btn btn-primary btn-sm btn-collapse collapsed" data-bs-toggle="collapse" [attr.data-bs-target]="'#' + this.legElementId" aria-expanded="false" [attr.aria-controls]="this.legElementId">{{ this.legInfoDataModel.serviceIntermediaryStopsText }} <i class="bi bi-chevron-down"></i><i class="bi bi-chevron-up"></i></button>
    </div>

    <div class="service-attributes">
      <div class="d-flex gap-1 align-items-center">
        <div class="service-attribute" *ngFor="let attrData of this.legInfoDataModel.serviceAttributes">
          <sbb-tooltip svgIcon="{{ attrData.icon }}" class="sbb-icon-fit">
            <div>
              {{ attrData.caption }}
            </div>
          </sbb-tooltip>
        </div>
      </div>
    </div>

    <div class="mt-2" *ngIf="this.legInfoDataModel.hasSituations">
      <div class="d-flex gap-2">
        <div *ngFor="let situationData of this.legInfoDataModel.situations">
          <sbb-tooltip svgIcon="fpl:info">
            <p>
              <strong>{{ situationData.summary }}</strong>
            </p>
            <div>
              {{ situationData.description }}
            </div>
            <ul class="tooltip-list">
              <li *ngFor="let detailText of situationData.details">
                {{ detailText }}
              </li>
            </ul>
          </sbb-tooltip>
        </div>
      </div>
    </div>
  </div>

  <div class="py-2 collapse" [id]="this.legElementId">
    <div class="d-flex gap-2">
      <div class="flex-grow-1">
        <div *ngFor="let locationData of this.legInfoDataModel.intermediaryLocationsData">
          {{ locationData.locationText }}
        </div>
      </div>
      <div>
        <div *ngFor="let locationData of this.legInfoDataModel.intermediaryLocationsData">
          <div>{{ locationData.arrText ?? 'â€€' }} <span class="time-delay">{{ locationData.arrDelayText }}</span></div>
        </div>
      </div>
      <div>
        <div *ngFor="let locationData of this.legInfoDataModel.intermediaryLocationsData">
          {{ locationData.depText }} <span class="time-delay">{{ locationData.depDelayText }}</span>
        </div>
      </div>
    </div>
  </div>
</ng-template>
